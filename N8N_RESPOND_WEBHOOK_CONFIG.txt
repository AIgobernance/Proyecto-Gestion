CONFIGURACIÓN DEL NODO "RESPOND TO WEBHOOK" EN N8N
====================================================

OPCIÓN 1: Usar "First Incoming Item" (MÁS SIMPLE)
---------------------------------------------------

Si el nodo Function anterior ya retorna el JSON correcto, puedes usar:

Configuración:
- Respond With: "First Incoming Item"
- Response Code: 200

Esto retornará directamente el JSON del nodo anterior sin modificaciones.

---

OPCIÓN 2: Usar "JSON" con Expresión Personalizada (RECOMENDADA)
------------------------------------------------------------------

Si necesitas formatear la respuesta específicamente:

Configuración:
- Respond With: "JSON"
- Response Code: 200
- Response Body (expresión):

```javascript
={{ JSON.stringify({ 
  html: $json.html || '', 
  id_evaluacion: $json.id_evaluacion || null, 
  puntuacion: $json.puntuacion || $json.score || null, 
  score: $json.puntuacion || $json.score || null
}) }}
```

⚠️ IMPORTANTE: 
- Si el HTML es muy largo, N8N puede truncarlo en la vista previa, pero se enviará completo
- Asegúrate de que el nodo Function anterior retorne el HTML en `$json.html`

---

ESTRUCTURA ESPERADA DEL INPUT

El nodo "Respond to Webhook" debe recibir un JSON con esta estructura:

```json
{
  "html": "<!DOCTYPE html>... (HTML completo)",
  "id_evaluacion": 57,
  "puntuacion": 85.5,
  "score": 85.5,
  "timestamp": "2025-01-23T10:30:00.000Z"
}
```

---

VERIFICACIÓN

1. Ejecuta el workflow hasta el nodo Function que procesa el HTML
2. Verifica el OUTPUT de ese nodo - debe tener el campo `html` con el HTML completo
3. Conecta ese nodo al "Respond to Webhook"
4. Ejecuta el nodo "Respond to Webhook"
5. Verifica el OUTPUT - debe mostrar el JSON con `html`, `id_evaluacion`, `puntuacion`

---

SOLUCIÓN SI EL HTML NO SE MUESTRA COMPLETO

Si en el OUTPUT de N8N el HTML aparece truncado o como `[Object]`:

1. El HTML se está enviando correctamente (N8N solo lo trunca en la vista)
2. Laravel recibirá el HTML completo
3. Para verificar, revisa los logs de Laravel después de recibir la respuesta

---

ERRORES COMUNES

1. "html is undefined"
   - Solución: Verifica que el nodo Function anterior retorne `html` en el JSON

2. "Cannot stringify circular structure"
   - Solución: Asegúrate de usar `JSON.stringify()` correctamente

3. HTML truncado en la vista
   - Solución: Es normal, el HTML completo se enviará a Laravel

